"use strict";angular.module("tripinApp").controller("RegisterCtrl",function($scope,$rootScope,$location,userService,Upload,env,$timeout){var vm=this;vm.newUser={},vm.loading=!1,vm.addNewUser=function(){vm.newUser.admin="false",vm.loading=!0,userService.addNewUser(vm.newUser).then(function(user){vm.loading=!1,alert('Use "'+user.username+'" as Username to login'),$location.path("/login")})},vm.submitForm=function(){console.log($scope.registerUser),$scope.registerUser.$valid&&vm.addNewUser()};var uploadedImages=[],uploadCount=0;$scope.allUploadFinished=!1,$scope.sectionLoading=!1,$scope.updateImages=function(){var product={};product._id=$routeParams.id,product.images=uploadedImages,$scope.sectionLoading=!0,productService.updateProductImages(product).then(function(product){$scope.sectionLoading=!1,$location.path("/product/"+product._id)})},$scope.uploadFiles=function(files,errFiles){vm.newUser.photo="",console.log(files),files.length&&($scope.files=files),$scope.errFiles=errFiles,angular.forEach(files,function(file){file.upload=Upload.upload({url:env.TRIPINAPIURL+"uploadImages",data:{file:file}}),file.upload.then(function(response){$timeout(function(){0===uploadCount&&(uploadedImages=response.data.filesUploaded),file.result=response.data,uploadCount++,uploadCount===$scope.files.length&&($scope.allUploadFinished=!0),vm.newUser.photo=files[0].name,vm.newUser.avatar=response.data.url,console.log(response.data.url)})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total)),100===file.progress?file.uploadFinished=!0:file.uploadFinished=!1})})},this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]});